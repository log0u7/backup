#!/usr/bin/env bash

set -e

flags=""
if [[ -n "${DEBUG}" ]]; then
  set -x
fi

dir=$1
exclude_paths=$2
mark=$3
sa_key_path=$4
bucket=$5
destination=$6
storage_class=$7

if [[ "${storage_class}" ]]; then
  flags="${flags} -s ${storage_class}"
fi

configure_gcp "${sa_key_path}"
pack "${dir}" "-" "" "${exclude_paths}" "${mark}" | gsutil cp $flags "-" "gs://${bucket}/${destination}"
